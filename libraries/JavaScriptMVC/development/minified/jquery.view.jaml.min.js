(function(){Jaml=function(){return{templates:{},helpers:{},register:function(a,b){this.templates[a]=b},render:function(a,b){return(new Jaml.Template(this.templates[a])).render(b)},registerHelper:function(a,b){this.helpers[a]=b}}}();Jaml.Node=function(a){this.tagName=a;this.attributes={};this.children=[]};Jaml.Node.prototype={setAttributes:function(a){for(var b in a)this.attributes[b=="cls"?"class":b]=a[b]},addChild:function(a){this.children.push(a)},render:function(a){a=a||0;var b=[],c=[],h=this instanceof
Jaml.TextNode,f=this.multiLineTag();for(var d in this.attributes)c.push(d+"="+this.attributes[d]);h||b.push(this.getPadding(a));b.push("<"+this.tagName);for(d in this.attributes)b.push(" "+d+'="'+this.attributes[d]+'"');if(this.isSelfClosing())b.push(" />\n");else{b.push(">");f&&b.push("\n");for(c=0;c<this.children.length;c++)b.push(this.children[c].render(a+2));f&&b.push(this.getPadding(a));b.push("</",this.tagName,">\n")}return b.join("")},multiLineTag:function(){var a=this.children.length,b=a>
0;if(a==1&&this.children[0]instanceof Jaml.TextNode)b=false;return b},getPadding:function(a){return(new Array(a+1)).join(" ")},isSelfClosing:function(){for(var a=false,b=this.selfClosingTags.length-1;b>=0;b--)if(this.tagName==this.selfClosingTags[b])a=true;return a},selfClosingTags:["img","meta","br","hr"]};Jaml.TextNode=function(a){this.text=a};Jaml.TextNode.prototype={render:function(){return this.text}};Jaml.Template=function(a){this.tpl=a;this.nodes=[]};Jaml.Template.prototype={render:function(a){a=
a||{};if(a.constructor.toString().indexOf("Array")==-1)a=[a];with(this)for(var b=0;b<a.length;b++)eval("("+this.tpl.toString()+")(data[i])");a=this.getRoots();var c="";for(b=0;b<a.length;b++)c+=a[b].render();return c},getRoots:function(){for(var a=[],b=0;b<this.nodes.length;b++){var c=this.nodes[b];c.parent==undefined&&a.push(c)}return a},tags:["html","head","body","script","meta","title","link","script","div","p","span","a","img","br","hr","table","tr","th","td","thead","tbody","ul","ol","li","dl",
"dt","dd","h1","h2","h3","h4","h5","h6","h7","form","input","label"]};(function(){for(var a=Jaml.Template.prototype.tags,b=a.length-1;b>=0;b--){var c=a[b];Jaml.Template.prototype[c]=function(h){return function(f){var d=new Jaml.Node(h),g=typeof f=="object"&&!(f instanceof Jaml.Node)&&!(f instanceof Jaml.TextNode);g&&d.setAttributes(f);for(g=g?1:0;g<arguments.length;g++){var e=arguments[g];if(typeof e=="string"||e==undefined)e=new Jaml.TextNode(e||"");if(e instanceof Jaml.Node||e instanceof Jaml.TextNode)e.parent=
d;d.addChild(e)}this.nodes.push(d);return d}}(c)}})();$.View.register({suffix:"jaml",script:function(a,b){return"((function(){ Jaml.register("+a+", "+b+"); return function(data){return Jaml.render("+a+", data)} })())"},renderer:function(a,b){var c;eval("func = ("+b+")");Jaml.register(a,c);return function(h){return Jaml.render(a,h)}}})})(jQuery);
