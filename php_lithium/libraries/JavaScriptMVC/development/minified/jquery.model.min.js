(function(){var n=$.String.underscore,z=$.String.classize,s=$.isArray,u=$.makeArray,t=$.extend,j=$.each,A=/GET|POST|PUT|DELETE/i,k=function(a,b,c,d,f,e,g){g=g||"json";var h="";if(typeof a=="string"){var i=a.indexOf(" ");if(i>2&&i<7){h=a.substr(0,i);if(A.test(h))e=h;else g=h;h=a.substr(i+1)}else h=a}typeof b=="object"&&!s(b)&&(b=t({},b));a=$.String.sub(h,b,true);return $.ajax({url:a,data:b,success:c,error:d,type:e||"post",dataType:g,fixture:f})},l=function(a,b){var c=n(this.shortName),d="-"+c+(a||
"");return $.fixture&&$.fixture[d]?d:b||"//"+n(this.fullName).replace(/\.models\..*/,"").replace(/\./g,"/")+"/fixtures/"+c+(a||"")+".json"},B=function(a,b){a=a||{};var c=this.id;if(a[c]&&a[c]!==b){a["new"+$.String.capitalize(b)]=a[c];delete a[c]}a[c]=b;return a},v=function(a){return new (a||$.Model.List||Array)},o=function(a){return a[a.constructor.id]},C=function(a){for(var b=[],c=0;c<a.length;c++)if(!a[c]["__u Nique"]){b.push(a[c]);a[c]["__u Nique"]=true}for(c=0;c<b.length;c++)delete b[c]["__u Nique"];
return b},w=function(a,b,c,d,f){var e=$.Deferred(),g=[a.serialize(),function(i){a[f||b+"d"](i);e.resolveWith(a,[a,i,b])},function(i){e.rejectWith(a,[i])}],h=a.constructor;b=="destroy"&&g.shift();b!=="create"&&g.unshift(o(a));e.then(c);e.fail(d);h[b].apply(h,g);return e.promise()},p=function(a){return typeof a==="object"&&a!==null&&a},m=function(a){return function(){$.fn[a].apply($([this]),arguments);return this}},x=m("bind");m=m("unbind");ajaxMethods={create:function(a){return function(b,c,d){return k(a,
b,c,d,l.call(this,"Create","-restCreate"))}},update:function(a){return function(b,c,d,f){return k(a,B.call(this,c,b),d,f,l.call(this,"Update","-restUpdate"),"put")}},destroy:function(a){return function(b,c,d){var f={};f[this.id]=b;return k(a,f,c,d,l.call(this,"Destroy","-restDestroy"),"delete")}},findAll:function(a){return function(b,c,d){return k(a||this.shortName+"s.json",b,c,d,l.call(this,"s"),"get","json "+this._shortName+".models")}},findOne:function(a){return function(b,c,d){return k(a,b,c,
d,l.call(this),"get","json "+this._shortName+".model")}}};jQuery.Class("jQuery.Model",{setup:function(a){var b=this;j(["attributes","associations","validations"],function(f,e){if(!b[e]||a[e]===b[e])b[e]={}});j(["convert","serialize"],function(f,e){if(a[e]!=b[e])b[e]=t({},a[e],b[e])});this._fullName=n(this.fullName.replace(/\./g,"_"));this._shortName=n(this.shortName);if(this.fullName.substr(0,7)!="jQuery."){if(this.listType)this.list=new this.listType([]);for(var c in ajaxMethods)if(typeof this[c]!==
"function")this[c]=ajaxMethods[c](this[c]);c={};var d="* "+this._shortName+".model";c[d+"s"]=this.proxy("models");c[d]=this.proxy("model");$.ajaxSetup({converters:c})}},attributes:{},model:function(a){if(!a)return null;if(a instanceof this)a=a.serialize();return new this(p(a[this._shortName])||p(a.data)||p(a.attributes)||a)},models:function(a){if(!a)return null;var b=v(this.List),c=s(a),d=$.Model.List&&a instanceof $.Model.List;d=c?a:d?a.serialize():a.data;var f=d.length,e=0;for(b._use_call=true;e<
f;e++)b.push(this.model(d[e]));if(!c)for(var g in a)if(g!=="data")b[g]=a[g];return b},id:"id",addAttr:function(a,b){if(!this.associations[a]){this.attributes[a]||(this.attributes[a]=b);return b}},_models:{},publish:function(a,b){window.OpenAjax&&OpenAjax.hub.publish(this._shortName+"."+a,b)},guessType:function(){return"string"},convert:{date:function(a){var b=typeof a;return b==="string"?isNaN(Date.parse(a))?null:Date.parse(a):b==="number"?new Date(a):a},number:function(a){return parseFloat(a)},"boolean":function(a){return Boolean(a)},
"default":function(a,b,c){b=$.String.getObject(c);var d=window;if(c.indexOf(".")>=0){c=c.substring(0,c.lastIndexOf("."));d=$.String.getObject(c)}return typeof b=="function"?b.call(d,a):a}},serialize:{"default":function(a){return p(a)&&a.serialize?a.serialize():a}},bind:x,unbind:m,_ajax:k},{setup:function(a){this._init=true;this.attrs(t({},this.constructor.defaults,a));delete this._init},update:function(a,b,c){this.attrs(a);return this.save(b,c)},errors:function(a){if(a)a=s(a)?a:u(arguments);var b=
{},c=this,d=function(g,h){j(h,function(i,q){if(i=q.call(c)){b.hasOwnProperty(g)||(b[g]=[]);b[g].push(i)}})},f=this.constructor.validations;j(a||f||{},function(g,h){if(typeof g=="number"){g=h;h=f[g]}d(g,h||[])});for(var e in b)if(b.hasOwnProperty(e))return b;return null},attr:function(a,b,c,d){var f=z(a),e="get"+f;if(b!==undefined){this._setProperty(a,b,c,d,f);return this}return this[e]?this[e]():this[a]},bind:x,unbind:m,_setProperty:function(a,b,c,d,f){f="set"+f;var e=this[a],g=this,h=function(i){d&&
d.call(g,i);$(g).triggerHandler("error."+a,i)};this[f]&&(b=this[f](b,this.proxy("_updateProperty",a,b,e,c,h),h))===undefined||this._updateProperty(a,b,e,c,h)},_updateProperty:function(a,b,c,d,f){var e=this.constructor,g=e.attributes[a]||e.addAttr(a,e.guessType(b)),h=e.convert[g]||e.convert["default"],i=null,q="",y="updated.";d=d;var r=e.list;b=this[a]=b===null?null:h.call(e,b,function(){},g);this._init||(i=this.errors(a));g=[b];h=[a,b,c];if(i){q=y="error.";d=f;h.splice(1,0,i);g.unshift(i)}if(c!==
b&&!this._init){!i&&$(this).triggerHandler(q+a,g);$(this).triggerHandler(y+"attr",h)}d&&d.apply(this,g);if(a===e.id&&b!==null&&r)if(c){if(c!=b){r.remove(c);r.push(this)}}else r.push(this)},removeAttr:function(a){var b=this[a],c=false,d=this.constructor.attributes;this[a]&&delete this[a];if(d[a]){delete d[a];c=true}!this._init&&c&&b&&$(this).triggerHandler("updated.attr",[a,null,b])},attrs:function(a){var b,c=this.constructor,d=c.attributes;if(a){c=c.id;for(b in a)b!=c&&this.attr(b,a[b]);c in a&&this.attr(c,
a[c])}else{a={};for(b in d)if(d.hasOwnProperty(b))a[b]=this.attr(b)}return a},serialize:function(){var a=this.constructor,b=a.attributes,c,d,f={},e;attributes={};for(e in b)if(b.hasOwnProperty(e)){c=b[e];d=a.serialize[c]||a.serialize["default"];f[e]=d(this[e],c)}return f},isNew:function(){var a=o(this);return a===undefined||a===null},save:function(a,b){return w(this,this.isNew()?"create":"update",a,b)},destroy:function(a,b){return w(this,"destroy",a,b,"destroyed")},identity:function(){var a=o(this),
b=this.constructor;return(b._fullName+"_"+(b.escapeIdentity?encodeURIComponent(a):a)).replace(/ /g,"_")},elements:function(a){return $("."+this.identity(),a)},publish:function(a,b){this.constructor.publish(a,b||this)},hookup:function(a){var b=this.constructor._shortName,c=$.data(a,"models")||$.data(a,"models",{});$(a).addClass(b+" "+this.identity());c[b]=this}});j(["created","updated","destroyed"],function(a,b){$.Model.prototype[b]=function(c){var d=this.constructor;b==="destroyed"&&d.list&&d.list.remove(o(this));
c&&typeof c=="object"&&this.attrs(c.attrs?c.attrs():c);$(this).triggerHandler(b);this.publish(b,this);$([d]).triggerHandler(b,this);return[this].concat(u(arguments))}});$.fn.models=function(){var a=[],b,c;this.each(function(){j($.data(this,"models")||{},function(d,f){b=b===undefined?f.constructor.List||null:f.constructor.List===b?b:null;a.push(f)})});c=v(b);c.push.apply(c,C(a));return c};$.fn.model=function(a){if(a&&a instanceof $.Model){a.hookup(this[0]);return this}else return this.models.apply(this,
arguments)[0]}})(jQuery);
