(function(c){c.ajaxPrefilter(function(a,b){if(c.fixture.on){var d=x(a);if(a.fixture){if(typeof a.fixture==="string"&&c.fixture[a.fixture])a.fixture=c.fixture[a.fixture];if(typeof a.fixture=="string"){b=a.fixture;if(/^\/\//.test(b))b=steal.root.join(a.fixture.substr(2));a.url=b;a.data=null;a.type="GET";if(!a.error)a.error=function(f,g,j){throw"fixtures.js Error "+g+" "+j;}}else{a.dataTypes.splice(0,0,"fixture");d&&c.extend(b.data,d)}}}});c.ajaxTransport("fixture",function(a,b){a.dataTypes.shift();
var d=a.dataTypes[0],f;return{send:function(g,j){f=setTimeout(function(){var i=a.fixture(b,a,g);if(!c.isArray(i)){var n=[{}];n[0][d]=i;i=n}typeof i[0]!="number"&&i.unshift(200,"success");if(!i[2]||!i[2][d]){n={};n[d]=i[2];i[2]=n}j.apply(null,i)},c.fixture.delay)},abort:function(){clearTimeout(f)}}});var p=[],w=function(a,b){for(var d=0;d<p.length;d++)if(u._similar(a,p[d],b))return d;return-1},x=function(a){var b=w(a);if(b>-1){a.fixture=p[b].fixture;return u._getData(p[b].url,a.url)}},o=function(a){var b=
a.data.id;if(b===undefined&&typeof a.data==="number")b=a.data;b===undefined&&a.url.replace(/\/(\d+)(\/|$|\.)/g,function(d,f){b=f});if(b===undefined)b=a.url.replace(/\/(\w+)(\/|$|\.)/g,function(d,f){if(f!="update")b=f});if(b===undefined)b=Math.round(Math.random()*1E3);return b},u=c.fixture=function(a,b){if(b!==undefined){if(typeof a=="string"){var d=a.match(/(GET|POST|PUT|DELETE) (.+)/i);a=d?{url:d[2],type:d[1]}:{url:a}}d=w(a,!!b);d>-1&&p.splice(d,1);if(b!=null){a.fixture=b;p.push(a)}}},y=c.String._regs.replacer;
c.extend(c.fixture,{_similar:function(a,b,d){return d?c.Object.same(a,b,{fixture:null}):c.Object.subset(a,b,c.fixture._compare)},_compare:{url:function(a,b){return!!u._getData(b,a)},fixture:null,type:"i"},_getData:function(a,b){var d=[],f=(new RegExp(a.replace(y,function(j,i){d.push(i);return"([^/])+"})+"$")).exec(b),g={};if(!f)return null;f.shift();c.each(d,function(j,i){g[i]=f.shift()});return g},"-restUpdate":function(a){return[200,"succes",{id:o(a)},{location:a.url+"/"+o(a)}]},"-restDestroy":function(){return{}},
"-restCreate":function(a,b,d,f){f=f||parseInt(Math.random()*1E5,10);return[200,"succes",{id:f},{location:a.url+"/"+f}]},make:function(a,b,d,f){if(typeof a==="string")a=[a+"s",a];for(var g=c.fixture["~"+a[0]]=[],j=function(e){for(var h=0;h<g.length;h++)if(e==g[h].id)return g[h]},i=0;i<b;i++){var n=d(i,g);if(!n.id)n.id=i;g.push(n)}c.fixture["-"+a[0]]=function(e){var h=g.slice(0);e.data=e.data||{};c.each((e.data.order||[]).slice(0).reverse(),function(z,v){var l=v.split(" ");h=h.sort(function(q,r){return l[1].toUpperCase()!==
"ASC"?q[l[0]]<r[l[0]]?1:q[l[0]]==r[l[0]]?0:-1:q[l[0]]<r[l[0]]?-1:q[l[0]]==r[l[0]]?0:1})});c.each((e.data.group||[]).slice(0).reverse(),function(z,v){var l=v.split(" ");h=h.sort(function(q,r){return q[l[0]]>r[l[0]]})});var k=parseInt(e.data.offset,10)||0,s=parseInt(e.data.limit,10)||g.length-k,m=0;for(var t in e.data){m=0;if(e.data[t]!==undefined&&(t.indexOf("Id")!=-1||t.indexOf("_id")!=-1))for(;m<h.length;)if(e.data[t]!=h[m][t])h.splice(m,1);else m++}if(f)for(m=0;m<h.length;)if(f(h[m],e))m++;else h.splice(m,
1);return[{count:h.length,limit:e.data.limit,offset:e.data.offset,data:h.slice(k,k+s)}]};c.fixture["-"+a[1]]=function(e){return(e=j(o(e)))?[e]:[]};c.fixture["-"+a[1]+"Update"]=function(e,h){var k=o(e);c.extend(j(k),e.data);return c.fixture["-restUpdate"](e,h)};c.fixture["-"+a[1]+"Destroy"]=function(e,h){for(var k=o(e),s=0;s<g.length;s++)if(g[s].id==k){g.splice(s,1);break}c.extend(j(k),e.data);return c.fixture["-restDestroy"](e,h)};c.fixture["-"+a[1]+"Create"]=function(e,h){var k=d(g.length,g);c.extend(k,
e.data);if(!k.id)k.id=g.length;g.push(k);return c.fixture["-restCreate"](e,h,undefined,k.id)};return{getId:o,findOne:j,find:function(e){return j(o(e))}}},rand:function(a,b,d){if(typeof a=="number")return typeof b=="number"?a+Math.floor(Math.random()*(b-a)):Math.floor(Math.random()*a);var f=arguments.callee;if(b===undefined)return f(a,f(a.length+1));var g=[];a=a.slice(0);d||(d=b);d=b+Math.round(f(d-b));for(var j=0;j<d;j++)g.push(a.splice(f(a.length),1)[0]);return g},xhr:function(a){return c.extend({},
{abort:c.noop,getAllResponseHeaders:function(){return""},getResponseHeader:function(){return""},open:c.noop,overrideMimeType:c.noop,readyState:4,responseText:"",responseXML:null,send:c.noop,setRequestHeader:c.noop,status:200,statusText:"OK"},a)},on:true});c.fixture.delay=200;c.fixture["-handleFunction"]=function(a){if(typeof a.fixture==="string"&&c.fixture[a.fixture])a.fixture=c.fixture[a.fixture];if(typeof a.fixture=="function"){setTimeout(function(){a.success&&a.success.apply(null,a.fixture(a,"success"));
a.complete&&a.complete.apply(null,a.fixture(a,"complete"))},c.fixture.delay);return true}return false}})(jQuery);
