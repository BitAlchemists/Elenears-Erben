(function(i){var p=function(a){return a.replace(/^\/\//,"").replace(/[\/\.]/g,"_")},B=1,e,q,r,n=function(a){return a&&i.isFunction(a.always)},C=function(a){var b=[];if(n(a))return[a];else for(var c in a)n(a[c])&&b.push(a[c]);return b},v=function(a){return i.isArray(a)&&a.length===3&&a[1]==="success"?a[0]:a};e=i.View=function(a,b,c,d){if(typeof c==="function"){d=c;c=undefined}var f=C(b);if(f.length){var g=i.Deferred();f.push(r(a,true));i.when.apply(i,f).then(function(j){var k=i.makeArray(arguments),
l=k.pop()[0];if(n(b))b=v(j);else for(var m in b)if(n(b[m]))b[m]=v(k.shift());k=l(b,c);g.resolve(k);d&&d(k)});return g.promise()}else{var h;f=typeof d==="function";g=r(a,f);if(f){h=g;g.done(function(j){d(j(b,c))})}else g.done(function(j){h=j(b,c)});return h}};q=function(a,b){if(!a.match(/[^\s]/))throw"$.View ERROR: There is no template or an empty template at "+b;};r=function(a,b){return i.ajax({url:a,dataType:"view",async:b})};i.ajaxTransport("view",function(a,b){a=b.url;var c=a.match(/\.[\w\d]+$/),
d,f,g,h=a,j,k=function(l){l=d.renderer(g,l);if(e.cache)e.cached[g]=l;return{view:l}};if(f=document.getElementById(a))c=f.type.match(/\/[\d\w]+$/)[0].replace(/^\//,".");if(!c){c=e.ext;h+=e.ext}g=p(h);if(h.match(/^\/\//))h=typeof steal==="undefined"?"/"+h.substr(2):steal.root.mapJoin(h.substr(2));d=e.types[c];return{send:function(l,m){if(e.cached[g])return m(200,"success",{view:e.cached[g]});else if(f)m(200,"success",k(f.innerHTML));else j=i.ajax({async:b.async,url:h,dataType:"text",error:function(){q("",
h);m(404)},success:function(w){q(w,h);m(200,"success",k(w))}})},abort:function(){j&&j.abort()}}});i.extend(e,{hookups:{},hookup:function(a){var b=++B;e.hookups[b]=a;return b},cached:{},cache:true,register:function(a){this.types["."+a.suffix]=a;window.steal&&steal.type(a.suffix+" view js",function(b,c,d){c=e.types["."+b.type];var f=p(b.rootSrc);b.text=c.script(f,b.text);d()})},types:{},ext:".ejs",registerScript:function(a,b,c){return"$.View.preload('"+b+"',"+e.types["."+a].script(b,c)+");"},preload:function(a,
b){e.cached[a]=function(c,d){return b.call(c,c,d)}}});window.steal&&steal.type("view js",function(a,b,c){b=e.types["."+a.type];var d=p(a.rootSrc);a.text="steal('"+(b.plugin||"jquery/view/"+a.type)+"').then(function($){$.View.preload('"+d+"',"+a.text+");\n})";c()});var x,o,y,z,A,s,t;x=function(a){var b=i.fn[a];i.fn[a]=function(){var c=i.makeArray(arguments),d,f,g=this;if(n(c[0])){c[0].done(function(h){o.call(g,[h],b)});return this}else if(y(c)){if(d=A(c)){f=c[d];c[d]=function(h){o.call(g,[h],b);f.call(g,
h)};e.apply(e,c);return this}c=e.apply(e,c);if(n(c)){c.done(function(h){o.call(g,[h],b)});return this}else c=[c]}return o.call(this,c,b)}};o=function(a,b){var c;for(var d in e.hookups)break;if(d&&a[0]&&z(a[0])){c=e.hookups;e.hookups={};a[0]=i(a[0])}b=b.apply(this,a);c&&s(a[0],c);return b};y=function(a){var b=typeof a[1];return typeof a[0]=="string"&&(b=="object"||b=="function")&&!a[1].nodeType&&!a[1].jquery};z=function(a){if(a.jquery||a.nodeType===1)return true;else if(typeof a==="string"){a=i.trim(a);
return a.substr(0,1)==="<"&&a.substr(a.length-1,1)===">"&&a.length>=3}else return false};A=function(a){return typeof a[3]==="function"?3:typeof a[2]==="function"&&2};s=function(a,b){var c,d=0,f,g;a=a.filter(function(){return this.nodeType!=3});a=a.add("[data-view-id]",a);for(c=a.length;d<c;d++)if(a[d].getAttribute&&(f=a[d].getAttribute("data-view-id"))&&(g=b[f])){g(a[d],f);delete b[f];a[d].removeAttribute("data-view-id")}i.extend(e.hookups,b)};i.fn.hookup=function(){var a=e.hookups;e.hookups={};s(this,
a);return this};t=["prepend","append","after","before","text","html","replaceWith","val"];for(var u=0;u<t.length;u++)x(t[u])})(jQuery);
